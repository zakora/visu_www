<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
    fill: #eee;
    stroke: black;
    stroke-width: 0.5;
}

.subunit.ZAF { fill: red; }

</style>
<body>
<script src="lib/d3.v3.min.js"></script>
<script src="lib/topojson.v1.min.js"></script>
<script src="lib/colorbrewer.js"></script>
<script src="lib/queue.min.js"></script>
<script>
indexById = d3.map();

var width = 1000,
    height = 800;

var projection = d3.geo.mercator()
    .scale(100)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

// d3.json("worldmap.json", function(error, worldmap) {
//     svg.append("path")
//        .datum(topojson.feature(worldmap, worldmap.objects.subunits))
//        .attr("d", path);
//     svg.selectAll(".subunit")
//         .data(topojson.feature(worldmap, worldmap.objects.subunits).features)
//       .enter().append("path")
//         .attr("class", function(d) { return "subunit " + d.id; })
//         .attr("d", path);
// });

queue()
    .defer(d3.json, "worldmap.json")
    .defer(d3.json, "iso_index.json")
    .await(drawMap);

function drawMap(error, worldmap, iso_index) {
    svg.append("path")
       .datum(topojson.feature(worldmap, worldmap.objects.subunits))
       .attr("d", path)
       .attr("class", "world")
    svg.selectAll(".subunit")
       .data(topojson.feature(worldmap, worldmap.objects.subunits).features)
       .enter().append("path")
       .style("fill", function(d) {
            return colorbrewer.YlGn[9][ Math.floor(9 - (iso_index[d.id] | 0)/81*9)]; })
       .attr("class", function(d) { return iso_index[d.id] | 0; })
       .attr("d", path);
};
</script>
